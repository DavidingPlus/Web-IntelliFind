import{r as d,a as ce,u as de,W as ie,b as u,x as f,w as a,d as n,z as m,e as t,c as x,X as _e,h,Y as B,Z as U,_ as v,$ as me,a0 as pe,a1 as ve,a2 as fe,a3 as he,k as we,q as ge,a4 as ye,a5 as ke,B as q,a6 as be,m as C,a7 as Ee,t as L,p as Se,i as Ie,a8 as Ve,a9 as xe,aa as Ce,ab as De,ac as Ne,j as Fe}from"./index-bed6c77c.js";/* empty css                 */import{_ as Re}from"./PageContainer-634a4ae5.js";/* empty css                     *//* empty css                     *//* empty css               *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                    */import{_ as Be}from"./_plugin-vue_export-helper-c27b6911.js";const p=k=>(Se("data-v-d05aac47"),k=k(),Ie(),k),Ue={style:{position:"relative",width:"100%","max-height":"565px"}},Je=p(()=>n("br",null,null,-1)),Te=p(()=>n("br",null,null,-1)),$e=p(()=>n("div",{class:"el-upload__text"},[h(" 拖动JSON文件到此 或"),n("em",null," 点此上传 ")],-1)),je={key:1,class:"demo-progress",style:{display:"flex","flex-direction":"column","justify-content":"center","align-items":"center"}},qe=p(()=>n("br",null,null,-1)),Le=p(()=>n("br",null,null,-1)),Me=p(()=>n("br",null,null,-1)),Oe={class:"cell-item"},We=p(()=>n("br",null,null,-1)),ze=p(()=>n("h2",{style:{"text-align":"left"}},"自定义配置信息",-1)),Ae=p(()=>n("br",null,null,-1)),Pe={style:{display:"flex","align-items":"center"}},Xe={__name:"JsonSolve",setup(k){const w=d([{word:"跳出率较高",name:"stay_time",value:50},{word:"重复点击",name:"repeat_click",value:50},{word:"页面加载慢",name:"page_load",value:50},{word:"网络响应慢",name:"feedback_interval",value:50},{word:"页面无响应",name:"no_reaction",value:50},{word:"点击报错",name:"error_count",value:50},{word:"页面加载报错",name:"console_errors",value:50},{word:"页面出现白屏",name:"is_blank",value:50},{word:"出现多类问题",name:"occur_many",value:50}]),M=ce(),b={file_name:""},O=()=>{const e={name:[],value:[]};return w.value.forEach(o=>{let s=!1;r.value.items.forEach(l=>{l.name===o.name&&(e.name.push(l.name),e.value.push(l.value),s=!0)}),s||(e.name.push(o.name),e.value.push(o.value))}),e},D=d(),W=e=>{if(!e.raw){console.error("未选择文件");return}D.value=e.raw,P()},z=async e=>{if(!D.value){v.error("未选择文件");return}const o=new FormData;o.append("json_file",D.value);const s=O();s.name.forEach((l,I)=>{o.append(l,s.value[I])});try{e=await Ve.post("http://8.137.100.0:8080/core/upload-file",o,{headers:{Authorization:M.token}}),b.file_name=e.data.file_name,console.log("上传文件成功:",b.file_name)}catch(l){console.error("上传文件失败:",l),v.error("上传文件失败，请稍后重试")}},J=d(!0),E=d(0),T=d(!0),S=d(!1),A=()=>{E.value=0,setInterval(()=>{T.value&&(E.value+=2,E.value===100&&(T.value=!1,setTimeout(()=>{v.success("解析成功"),S.value=!1},300)))},250)},P=()=>{z(),setTimeout(()=>{J.value=!1,S.value=!0,A()},3e3)},X=de(),Y=()=>{console.log(b.file_name),X.push({path:"/json/show",query:{file_name:b.file_name}})},N=d(),r=d({items:[{name:"",word:"",value:"50"},{name:"",word:"",value:"50"}]}),$=d(1),Z=()=>{if($.value>=9){v.error("最多只能添加9个权重配置项");return}r.value.items.push({word:"",name:"",value:""}),c.value.push({word:""}),$.value++},G=e=>{r.value.items.splice(e,1)},H=async()=>{if(!N.value){v.error("表单未初始化");return}await N.value.validate();const e=[...w.value];for(const o of r.value.items){const s=e.find(l=>l.word===o.word);s&&(s.value=o.value)}w.value=e,v.success("保存成功")},c=d(r.value.items?r.value.items.map(e=>({word:e.word??""})):[{word:"",value:"",name:""}]),K=e=>{var o,s;if(r.value&&r.value.items){const l=c.value[e];c.value.filter((F,R)=>R!==e&&F.word===l.word).length>0?(v.error(`配置中不能存在重复的权重属性名：${l.word}`),c.value[e].word=""):c.value[e]=l;const V=((o=c.value)==null?void 0:o.length)>0&&((s=c.value[e])==null?void 0:s.word)||"",g=r.value.items[e];V?(g.word=V,g.rules=[{required:!1,message:"请输入权重值",trigger:"change"}]):(g.word="",g.rules=[{required:!0,message:"请输入权重值",trigger:"change"}])}else console.error("formModel 或 formModel.items 是 undefined")},Q=ie(()=>e=>{const o=c.value.map(l=>l.word).filter(l=>l);if(o.length===0)return w.value.map(l=>({word:l.word}));const s=[...o.slice(0,e),...o.slice(e+1)];return w.value.map(l=>({word:l.word})).filter(l=>!s.includes(l.word))}),ee=e=>{const o=parseFloat(e.value);(isNaN(o)||o<0||o>100)&&v.error("请输入0~100之间的数值")},le={fontSize:"15px",marginRight:"10px"};return(e,o)=>{const s=me,l=pe,I=xe,V=Ce,g=ve,F=fe,R=he,oe=De,ae=Ne,te=Fe,j=we,se=ge,ne=Re,re=ye;return u(),f(ne,{title:"JSON解析"},{default:a(()=>[n("div",Ue,[J.value?(u(),f(m(ke),{key:0,type:"file",class:"upload-demo",drag:"",multiple:"",action:"#","auto-upload":!1,"on-change":W},{default:a(()=>[t(m(q),{class:"el-icon--upload"},{default:a(()=>[t(m(be))]),_:1}),Je,Te,$e]),_:1})):(u(),x("div",je,[qe,t(s,{"text-inside":!0,"stroke-width":24,percentage:E.value,status:"success",style:{width:"80%"}},null,8,["percentage"]),Le,S.value?_e((u(),f(l,{key:0,style:{width:"100%"}},null,512)),[[re,S.value]]):(u(),f(m(C),{key:1,type:"success",onClick:Y,round:""},{default:a(()=>[h("点此查看解析详情")]),_:1}))]))]),Me,t(g,{column:3,border:""},{default:a(()=>[(u(!0),x(U,null,B(w.value,(y,i)=>(u(),f(V,{key:i},{label:a(()=>[n("div",Oe,[t(m(q),{style:le},{default:a(()=>[t(m(Ee))]),_:1}),h(" "+L(y.word),1)])]),default:a(()=>[t(I,null,{default:a(()=>[h(L(y.value),1)]),_:2},1024)]),_:2},1024))),128))]),_:1}),We,t(se,{ref_key:"formRef",ref:N,model:r.value,style:{display:"flex","flex-direction":"column"}},{default:a(()=>[t(R,null,{default:a(()=>[t(F,{span:24},{default:a(()=>[ze]),_:1})]),_:1}),Ae,(u(!0),x(U,null,B(r.value.items,(y,i)=>(u(),f(j,{key:i,prop:"items."+i+".word"},{default:a(()=>[n("div",Pe,[t(ae,{modelValue:c.value[i].word,"onUpdate:modelValue":_=>c.value[i].word=_,onChange:_=>K(i),placeholder:"请选择权重属性"},{default:a(()=>[(u(!0),x(U,null,B(Q.value(i),(_,ue)=>(u(),f(oe,{key:ue,label:_.word,value:_.word},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),t(te,{modelValue:y.value,"onUpdate:modelValue":_=>y.value=_,type:"number",onInput:_=>ee(y),placeholder:"请输入0~100之间的数值"},null,8,["modelValue","onUpdate:modelValue","onInput"]),t(m(C),{type:"danger",onClick:_=>G(i),class:"cancel"},{default:a(()=>[h("删除")]),_:2},1032,["onClick"])])]),_:2},1032,["prop"]))),128)),t(j,null,{default:a(()=>[t(m(C),{type:"primary",onClick:H},{default:a(()=>[h("保存配置")]),_:1}),t(m(C),{onClick:Z},{default:a(()=>[h("新增权重配置")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}},tl=Be(Xe,[["__scopeId","data-v-d05aac47"]]);export{tl as default};
