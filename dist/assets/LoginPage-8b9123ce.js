import{g as L,u as P,a as B,r as p,o as $,n as A,b as G,c as H,d as n,e as a,w as l,E as K,f as S,h as v,t as j,p as Q,i as W,j as X,k as Y,l as Z,m as ee,q as ae,s as le}from"./index-a9c24727.js";/* empty css                     *//* empty css                    */import"./index-c25176ff.js";import{_ as se}from"./_plugin-vue_export-helper-c27b6911.js";const u=y=>(Q("data-v-901e0b03"),y=y(),W(),y),oe={class:"login-body"},te=u(()=>n("div",{class:"bg"},null,-1)),ne={class:"login-panel"},re=u(()=>n("div",{class:"login-title"},"服创",-1)),ie=u(()=>n("span",{class:"iconfont icon-email"},null,-1)),ue=u(()=>n("span",{class:"iconfont icon-password"},null,-1)),de=u(()=>n("span",{class:"iconfont icon-password"},null,-1)),me=["src"],ce={class:"remenberme-panel"},pe=u(()=>n("div",{class:"login-title"},"服创",-1)),fe=u(()=>n("span",{class:"iconfont icon-yonghuming"},null,-1)),_e={class:"send-email-panel"},ge=u(()=>n("span",{class:"iconfont icon-email"},null,-1)),ve=u(()=>n("span",{class:"iconfont icon-youxiangyanzhengma"},null,-1)),be=u(()=>n("span",{class:"iconfont icon-password"},null,-1)),ye=u(()=>n("div",{class:"login-title"},"服创",-1)),we={class:"send-email-panel"},Ve=u(()=>n("span",{class:"iconfont icon-email"},null,-1)),ke=u(()=>n("span",{class:"iconfont icon-youxiangyanzhengma"},null,-1)),he=u(()=>n("span",{class:"iconfont icon-password"},null,-1)),xe={__name:"LoginPage",setup(y){const{proxy:r}=L(),z=P(),R=B(),f={checkCode:"/capatcha-code",login:"/login",signup:"/signup",sendcode:"/send-code",reset:"/reset",isexist:"/is-exist"},d=p({}),w=p(),V={username:[{required:!0,message:"请输入用户名"}],email:[{required:!0,message:"请输入邮箱"}],password:[{required:!0,message:"请输入密码"}],answer:[{required:!0,message:"请输入图形验证码"}],verify_code:[{required:!0,message:"请输入邮箱验证码"}]},T=p(null);let q="";const k=async()=>{let i={time:new Date().getTime()},e=await r.Request({url:f.checkCode,params:i});e&&(T.value=e.captcha_image,q=e.captcha_id)},O=()=>{w.value.validate(async i=>{if(!i)return;let e={};Object.assign(e,d.value,{captcha_id:q});let o=r.VueCookies.get("loginInfo");o==null||o.password;let s=await r.Request({url:f.login,params:JSON.stringify(e),dataType:"json",errorCallback:()=>{k()}});if(s){if(e.rememberMe){const M={email:e.email,password:e.password,rememberMe:e.rememberMe};r.VueCookies.set("loginInfo",M,"7d")}else r.VueCookies.remove("loginInfo");r.Message.success("登陆成功"),sessionStorage.setItem("userInfo",JSON.stringify(s.data)),console.log(s.token),R.setToken(s.token),console.log(R.token),z.push("/user/profile")}})};$(()=>{U()});const U=()=>{A(()=>{k(),w.value.resetFields(),d.value={};const i=r.VueCookies.get("loginInfo");i&&(d.value=i)})},m=p({}),h=p(),_=p(0),D=()=>{h.value.validateField("email",async i=>{if(!i)return;if(_.value===0){_.value=60;const s=setInterval(()=>{_.value>0?_.value--:clearInterval(s)},1e3)}let e={};Object.assign(e,{email:m.value.email});let o=await r.Request({url:f.isexist,params:JSON.stringify(e),dataType:"json"});if(o)if(o.code==2){if(!await r.Request({url:f.sendcode,params:JSON.stringify(e),dataType:"json"}))return;r.Message.success("验证码发送成功，请回邮箱查看")}else r.Message.warning("邮箱已注册，请重新输入邮箱")})},E=()=>{h.value.validate(async i=>{if(!i)return;let e={};Object.assign(e,m.value),await r.Request({url:f.signup,params:JSON.stringify(e),dataType:"json"})&&(r.Message.success("注册成功"),z.push("/login"))})},c=p({}),x=p(),g=p(0),N=()=>{x.value.validateField("email",async i=>{if(!i)return;if(g.value===0){g.value=60;const s=setInterval(()=>{g.value>0?g.value--:clearInterval(s)},1e3)}let e={};Object.assign(e,{emial:c.value.email});let o=await r.Request({url:f.isexist,params:JSON.stringify(e),dataType:"json"});if(o)if(o.data==1){if(!await r.Request({url:f.sendcode,params:JSON.stringify(e),dataType:"json"}))return}else r.Message.warning("邮箱未注册，请输入正确邮箱")})},J=()=>{x.value.validate(async i=>{if(!i)return;let e={};Object.assign(e,c.value),await r.Request({url:f.reset,params:JSON.stringify(e),dataType:"json"})&&r.Message.success("修改成功")})};return(i,e)=>{const o=X,s=Y,M=Z,b=ee,I=ae,C=le,F=K;return G(),H("div",oe,[te,n("div",ne,[a(F,{type:"border-card"},{default:l(()=>[a(C,{label:"登录"},{default:l(()=>[a(I,{class:"login-form",model:d.value,rules:V,ref_key:"formDataRef",ref:w,onSubmit:e[4]||(e[4]=S(()=>{},["prevent"]))},{default:l(()=>[re,a(s,{prop:"email"},{default:l(()=>[a(o,{size:"large",clearable:"",placeholder:"请输入邮箱",modelValue:d.value.email,"onUpdate:modelValue":e[0]||(e[0]=t=>d.value.email=t),modelModifiers:{trim:!0}},{prefix:l(()=>[ie]),_:1},8,["modelValue"])]),_:1}),a(s,{prop:"password"},{default:l(()=>[a(o,{size:"large",clearable:"","show-password":"",placeholder:"请输入密码",modelValue:d.value.password,"onUpdate:modelValue":e[1]||(e[1]=t=>d.value.password=t),modelModifiers:{trim:!0}},{prefix:l(()=>[ue]),_:1},8,["modelValue"])]),_:1}),a(s,{prop:"answer"},{default:l(()=>[a(o,{size:"large",clearable:"",placeholder:"请输入图形验证码",modelValue:d.value.answer,"onUpdate:modelValue":e[2]||(e[2]=t=>d.value.answer=t),modelModifiers:{trim:!0}},{prefix:l(()=>[de]),_:1},8,["modelValue"]),n("img",{src:T.value,class:"check-code",onClick:k},null,8,me)]),_:1}),a(s,null,{default:l(()=>[n("div",ce,[a(M,{modelValue:d.value.rememberMe,"onUpdate:modelValue":e[3]||(e[3]=t=>d.value.rememberMe=t)},{default:l(()=>[v("记住我")]),_:1},8,["modelValue"])])]),_:1}),a(s,null,{default:l(()=>[a(b,{type:"primary",class:"op-btn",onClick:O,size:"large"},{default:l(()=>[v("登录")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(C,{label:"注册"},{default:l(()=>[a(I,{class:"login-form",model:m.value,rules:V,ref_key:"formDataRef2",ref:h,onSubmit:e[9]||(e[9]=S(()=>{},["prevent"]))},{default:l(()=>[pe,a(s,{prop:"username"},{default:l(()=>[a(o,{size:"large",clearable:"",placeholder:"请输入用户名",modelValue:m.value.username,"onUpdate:modelValue":e[5]||(e[5]=t=>m.value.username=t),modelModifiers:{trim:!0}},{prefix:l(()=>[fe]),_:1},8,["modelValue"])]),_:1}),a(s,{prop:"email"},{default:l(()=>[n("div",_e,[a(o,{size:"large",clearable:"",placeholder:"请输入邮箱",modelValue:m.value.email,"onUpdate:modelValue":e[6]||(e[6]=t=>m.value.email=t),modelModifiers:{trim:!0}},{prefix:l(()=>[ge]),_:1},8,["modelValue"]),a(s,null,{default:l(()=>[a(b,{onClick:D,class:"send-mail-btn",size:"large",disabled:_.value>0},{default:l(()=>[v(j(_.value>0?`${_.value}秒后重试`:"发送"),1)]),_:1},8,["disabled"])]),_:1})])]),_:1}),a(s,{prop:"verify_code"},{default:l(()=>[a(o,{size:"large",clearable:"",placeholder:"请输入邮箱验证码",modelValue:m.value.verify_code,"onUpdate:modelValue":e[7]||(e[7]=t=>m.value.verify_code=t),modelModifiers:{trim:!0}},{prefix:l(()=>[ve]),_:1},8,["modelValue"])]),_:1}),a(s,{prop:"password"},{default:l(()=>[a(o,{size:"large",clearable:"","show-password":"",placeholder:"请输入密码",modelValue:m.value.password,"onUpdate:modelValue":e[8]||(e[8]=t=>m.value.password=t),modelModifiers:{trim:!0}},{prefix:l(()=>[be]),_:1},8,["modelValue"])]),_:1}),a(s,null,{default:l(()=>[a(b,{type:"primary",class:"op-btn",onClick:E,size:"large"},{default:l(()=>[v("注册")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(C,{label:"修改密码"},{default:l(()=>[a(I,{class:"login-form",model:c.value,rules:V,ref_key:"formDataRef3",ref:x,onSubmit:e[13]||(e[13]=S(()=>{},["prevent"]))},{default:l(()=>[ye,a(s,{prop:"email"},{default:l(()=>[n("div",we,[a(o,{size:"large",clearable:"",placeholder:"请输入邮箱",modelValue:c.value.email,"onUpdate:modelValue":e[10]||(e[10]=t=>c.value.email=t),modelModifiers:{trim:!0}},{prefix:l(()=>[Ve]),_:1},8,["modelValue"]),a(s,null,{default:l(()=>[a(b,{onClick:N,class:"send-mail-btn",size:"large",disabled:g.value>0},{default:l(()=>[v(j(g.value>0?`${g.value}秒后重试`:"发送"),1)]),_:1},8,["disabled"])]),_:1})])]),_:1}),a(s,{prop:"verify_code"},{default:l(()=>[a(o,{size:"large",clearable:"",placeholder:"请输入邮箱验证码",modelValue:c.value.verify_code,"onUpdate:modelValue":e[11]||(e[11]=t=>c.value.verify_code=t),modelModifiers:{trim:!0}},{prefix:l(()=>[ke]),_:1},8,["modelValue"])]),_:1}),a(s,{prop:"password"},{default:l(()=>[a(o,{size:"large",clearable:"","show-password":"",placeholder:"请输入重置后密码",modelValue:c.value.password,"onUpdate:modelValue":e[12]||(e[12]=t=>c.value.password=t),modelModifiers:{trim:!0}},{prefix:l(()=>[he]),_:1},8,["modelValue"])]),_:1}),a(s,null,{default:l(()=>[a(b,{type:"primary",class:"op-btn",onClick:J,size:"large"},{default:l(()=>[v("修改密码")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})])])}}},Re=se(xe,[["__scopeId","data-v-901e0b03"]]);export{Re as default};
